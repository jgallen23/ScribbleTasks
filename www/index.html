<!DOCTYPE HTML>
<html>
	<head>
		<title>ScribbleTask</title>
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, user-scalable = no, maximum-scale = 1.0">

		<link rel="stylesheet" type="text/css" href="ui/stylesheets/common.css"/>
		<link rel="stylesheet" type="text/css" href="ui/stylesheets/skins/paper.css"/>
	</head>
	<body>
		<div id="Wrapper" class="Wrapper"><div id="Wrapper2" class="Wrapper">
			<div id="ProjectList" class="Container">
				<header>
					<div class="title">Projects</div>
					<ul class="Toolbar">
						<!--<li><button class="Icon clear" data-onClick="clear"></button></li>-->
						<!--<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>-->
						<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
						<li><button class="Icon add" data-onClick="add"></button></li>
					</ul>
				</header>
				<div class="ProjectList">	
					<ul id="Projects"></ul>
				</div>
				<!--<footer>-->
				<!--<ul class="Toolbar">-->
						<!--<li><button class="Icon clear" data-onClick="clear"></button></li>-->
						<!--<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>-->
						<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
						<!--<li><button class="Icon add" data-onClick="add"></button></li>-->
						<!--</ul>-->
					<!--</footer>-->
			</div>	
			<div id="Project" class="Container Project">
				<header>
					<button class="Icon back" data-onClick="back"></button><div class="title"><input data-type="title" data-onClick="editTitle"/></div>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
						<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
						<li><button class="Icon star" data-onClick="filterStarred"></button></li>
						<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
						<li><button class="Icon add" data-onClick="add"></button></li>
					</ul>
				</header>
				<div class="TaskList">	
					<canvas id="tmpCanvas"></canvas>
					<ul id="Tasks"></ul>
				</div>
				<footer>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
						<li><button class="Icon incomplete current" data-onClick="filterAll"><span data-onClick="filterAll"></span></button></li>
						<li><button class="Icon star" data-onClick="filterStarred"><span data-onClick="filterStarred"></span></button></li>
						<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
					</ul>
				</footer>
			</div>
			<div id="AddTask">
				<div class="wrapper Modal">
					<div id="AddScribble"></div>
					<footer class="buttons">
						<ul class="Toolbar">
							<li><button class="Icon undo" data-onClick="undo"></button></li>
							<li><button class="Icon redo" data-onClick="redo"></button></li>
							<li><button class="Icon star off" data-onClick="star"></button></li>
							<li><button class="Icon priority" data-priority="0" data-onClick="priority"><span data-onClick="priority"></span></button>
								<section class="PriorityChooser Modal"></section>
							</li>
							<li><button class="Icon add" data-onClick="add">+</button></li>
							<li><button class="Icon addMulti" data-onClick="addAnother"></button></li>
							<li><button class="Icon clear" data-onClick="cancel"></button></li>
					</footer>
				</div>
			</div>
		</div></div>
		<script type="text/html" id="jstPriorityChooser">
			{! for (var pi = -1, c = 3; pi < c; pi++) { !}
				<button class="Icon priority" data-key="{!= key !}" data-priority="{!= pi !}" data-onClick="setPriority"><span data-onClick="setPriority"></span></button>
			{! } !}
		</script>
		<script type="text/html" id="jstProjectListView">
			{! for (var i = 0, c = projects.length; i < c; i++) { var project = projects[i]; !}
				<li>
					<div class="name" data-key="{!= project.key !}" data-index="{!= i !}" data-onClick="project">{!= project.name !}</div>
					<div class="count">{!= project.starCount !}</div>
					<div class="sep">/</div>
					<div class="count">{!= project.incompleteCount !}</div>
					<button data-index="{!= i !}" data-onClick="delete">X</button>
				</li>
			{! } !}
		</script>
		<script type="text/html" id="jstProjectView">
			{! for (var i = 0; i < tasks.length; i++) { var task = tasks[i]; !}
            <li data-key="{!= task.key !}" data-index="{!= i !}">
				{!= template("jstTaskView", { index: i, task: task, useImage: useImage }) !}
			</li>
			{! } !}	
		</script>
		<script type="text/html" id="jstTaskView">
			<div class="buttons">
				<input type="checkbox" data-onClick="complete" {!= (task.isComplete)?"checked":"" !}/>
				<button class="Icon priority" data-priority="{!= task.priority !}" data-onClick="priority"><span data-onClick="priority"></span></button>
				<section class="PriorityChooser Modal">
					{!= template("jstPriorityChooser", { key: index }) !}
				</section>
				<button data-index="{!= index !}" class="Icon star {!= (!task.star)?"off":"" !}" data-onClick="star"></button>
				<button class="Icon edit" data-onClick="task"></button>
			</div>
			{! if (task.name) { !}
			<div class="task" data-onClick="task">
				{!= task.name !}
			</div>
			{! } else { !}
			<div id="Scribble_{!= index !}" class="task scribble">
				{! if (!useImage) { !}
					<canvas></canvas>
				{! } else if (task.imageData) { !}
					<img src="{!= task.imageData !}"/>
				{! } !}
			</div>
			{! } !}
			<div class="complete {!= (task.isComplete)?"c":"" !}"></div>
		</script>
		<script src="phonegap.js"></script>
        <script src="ui/scripts/app.lawnchair.js"></script>
		<script src="ui/scripts/iscroll.js"></script>
		<script src="ui/scripts/Badge.js"></script>
		<script src="ui/scripts/SwipeController.js"></script>
		<script src="ui/scripts/ScribbleTasksApp.js"></script>
		<script src="dataproviders/projects.js"></script>
		<script src="dataproviders/tasks.js"></script>
		<script src="models/project.js"></script>
		<script src="models/task.js"></script>
		<script src="controllers/add_task.js"></script>
		<script src="controllers/project.js"></script>
		<script src="controllers/project_list.js"></script>
		<script src="views/scribble.js"></script>
		<!--
		<script src="ui/scripts/scribbletasks.min.js"></script>
		--!>
		<script>
            var app = new ScribbleTasksApp();
			var params = parseQueryString();

			if (params.mobile)
				app.browser.isMobile = true;
			if (!params.pg)
				app.browser.isPhoneGap = true;
			app.bind("resize", function(width, height) {
				if (this.browser.isPhoneGap)
					height -= 20;
				console.log(height);
				if (height < 500) {
					document.querySelector("#AddTask .wrapper").style.height = height+"px";
				}
				var wrapper = document.querySelector("#Wrapper");
				height -= (wrapper.offsetTop*2);	
				var containers = document.querySelectorAll(".Container");
				for (var i = 0, c = containers.length; i < c; i++) {
					containers[i].style.height = height+"px";
				}
				
			});
            app.bind("ready", function() {
				if (this.browser.isMobile) {
					/*
					if (!this.browser.isPhoneGap) {
						setTimeout(function() { 
							window.scrollTo(0, 1);
						}, 100);
					}
					*/
					app.disableScrollingPermanently();
				}
				app.resize();
				var c = new ProjectListController("ProjectList");
				var params = parseQueryString();
				//* Tests
				if (params.test) {
					var f = false;
					c.bind("loaded", function() {
						if (f) return;
						var pc = this.showProject(this.projects[0]);
						if (params.test == "2")
							pc.showAddTask();
						f = true;

					});
				}
				//*/
				window.controller = c;
			});
		</script>
	</body>
</html>
