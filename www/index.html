<!DOCTYPE HTML>
<html>
	<head>
		<title>ScribbleTask</title>
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, user-scalable = no, maximum-scale = 1.0">

		<link rel="stylesheet" type="text/css" href="ui/stylesheets/common.css"/>
		<script src="phonegap.js"></script>
        <script src="ui/scripts/app.lawnchair.js"></script>
		<script src="ui/scripts/app.sortable.js"></script>
		<script src="ui/scripts/iscroll.js"></script>
		<script src="ui/scripts/raphael.js"></script>
		<script src="ui/scripts/SwipeController.js"></script>
		<script src="dataproviders/projects.js"></script>
		<script src="dataproviders/tasks.js"></script>
		<script src="models/project.js"></script>
		<script src="models/task.js"></script>
		<script src="controllers/addtask.js"></script>
		<script src="controllers/project.js"></script>
		<script src="controllers/project_list.js"></script>
		<script src="views/scribble.js"></script>
		<script>
            var app = new Application();
			//app.browser.isMobile = true;
			//app.browser.isPhoneGap = true;
			app.bind("resize", function(width, height) {
				if (this.isPhoneGap)
					height -= 40;
				var containers = document.querySelectorAll(".Container");
				for (var i = 0, c = containers.length; i < c; i++) {
					containers[i].style.height = height+"px";
				}
				if (height < 500) {
					document.querySelector("#AddTask .wrapper").style.height = height+"px";
				}
			});
            app.bind("ready", function() {
				if (this.browser.isMobile) {
					/*
					if (!this.browser.isPhoneGap) {
						setTimeout(function() { 
							window.scrollTo(0, 1);
						}, 100);
					}
					*/
					app.disableScrollingPermanently();
				}
				app.resize();
				var c = new ProjectListController("ProjectList");
				/* Tests
				var f = false;
				c.bind("loaded", function() {
					if (f) return;
					var pc = this.showProject(this.projects[0]);
					pc.showAddTask();
					f = true;

				});
				//*/
				window.controller = c;
				/*
				Project.data.find(function(projects) {
					var project;
					if (projects.length == 0) {
						project = new Project({ name: 'test' });
						project.save();
					} else {
						project = projects[0];
					}
					window.project = project;
					window.controller = new ProjectController("Project", project);
				});
				*/
			});
		</script>
	</head>
	<body>
		<div id="ProjectList" class="Container">
			<header id="Header" class="Header">
				<div class="title">ScribbleTasks</div>
				<ul class="Toolbar">
					<li><button class="Icon clear" data-onClick="clear"></button></li>
					<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
					<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
					<li><button class="Icon add" data-onClick="add"></button></li>
				</ul>
			</header>
			<div class="ProjectList">	
				<ul id="Projects"></ul>
			</div>
			<footer>
				<ul class="Toolbar">
					<li><button class="Icon clear" data-onClick="clear"></button></li>
					<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
					<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
					<li><button class="Icon add" data-onClick="add"></button></li>
				</ul>
			</footer>
		</div>	
		<div id="Project" class="Container Project">
			<header id="Header" class="Header">
				<button data-onClick="back">&lt;</button><div class="title"><input data-type="title" data-onClick="editTitle"/></div>
				<ul class="Toolbar">
					<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
					<li><button class="Icon starred" data-onClick="filterStarred"></button></li>
					<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
					<li><button class="Icon add" data-onClick="add"></button></li>
				</ul>
			</header>
			<div class="TaskList">	
				<ul id="Tasks"></ul>
			</div>
			<footer>
				<ul class="Toolbar">
					<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
					<li><button class="Icon starred" data-onClick="filterStarred"></button></li>
					<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
					<li><button class="Icon add" data-onClick="add"></button></li>
				</ul>
			</footer>
		</div>
        <div id="AddTask">
			<div class="wrapper Paper">
				<div id="AddScribble"></div>
				<footer class="buttons">
					<button data-onClick="undo">U</button>
					<button data-onClick="redo">R</button>
					<button data-onClick="star">s</button>
					<button data-onClick="add">+</button>
					<button data-onClick="addAnother">++</button>
					<button data-onClick="cancel">Cancel</button>
				</footer>
			</div>
		</div>
		<script type="text/html" id="jstProjectListView">
			{! for (var i = 0, c = projects.length; i < c; i++) { var project = projects[i]; !}
				<li data-key="{!= project.key !}" data-index="{!= i !}" data-onClick="project">
					{!= project.name !}	
				</li>
			{! } !}
		</script>
		<script type="text/html" id="jstProjectView">
			{! for (var i = 0; i < tasks.length; i++) { var task = tasks[i]; !}
            <li data-key="{!= task.key !}" data-index="{!= i !}">
				{!= template("jstTaskView", { i: i, task: task }) !}
			</li>
			{! } !}	
		</script>
		<script type="text/html" id="jstTaskView">
			<div class="buttons">
				<input type="checkbox" data-onClick="complete" {!= (task.isComplete)?"checked":"" !}/>
				<button class="Icon star" style="opacity: {!= (task.star)?"1":".3" !}" data-onClick="star"></button>
				<button class="Icon" data-onClick="task">E</button>
			</div>
			{! if (task.name) { !}
			<div class="task" data-onClick="task">
				{!= task.name !}
			</div>
			{! } else { !}
			<div id="Scribble_{!= i !}" class="task scribble"></div>
			{! } !}
			<button class="Icon reorder" data-onClick="trigger"></button>
			<div class="complete {!= (task.isComplete)?"c":"" !}"></div>
		</script>
	</body>
</html>
