<!DOCTYPE HTML>
<html>
	<head>
		<title>ScribbleTask</title>
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, user-scalable = no, maximum-scale = 1.0">

		<link rel="stylesheet" type="text/css" href="ui/stylesheets/common.css"/>
		<link rel="stylesheet" type="text/css" href="ui/stylesheets/skins/paper.css"/>
	</head>
	<body>
		<div id="Wrapper" class="Wrapper"><div id="Wrapper2" class="Wrapper">
			<div id="ProjectList" class="Container">
				<header>
					<div class="title">Projects</div>
					<ul class="Toolbar">
						<!--<li><button class="Icon clear" data-onClick="clear"></button></li>-->
						<!--<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>-->
						<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
						<li><button class="Icon menu" data-onClick="debug"></button></li>
						<li><button class="Icon search" data-onClick="search"></button></li>
						<li><button class="Icon add" data-onClick="add"></button></li>
					</ul>
				</header>
				<div class="ProjectList">	
					<ul id="Projects"></ul>
				</div>
				<!--<footer>-->
				<!--<ul class="Toolbar">-->
						<!--<li><button class="Icon clear" data-onClick="clear"></button></li>-->
						<!--<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>-->
						<!--<li><button class="Icon complete" data-onClick="filterComplete"></button></li>-->
						<!--<li><button class="Icon add" data-onClick="add"></button></li>-->
						<!--</ul>-->
					<!--</footer>-->
				<div id="SearchPopup" class="Modal">
					<div class="wrapper Popup">
						<header><div class="title">Search</div><button class="Icon clear" data-onClick="searchClose"></button></header>
						<ul>
							<li><button class="Text" data-onClick="searchStarred">Starred</button></li>
							<li><button class="Text" data-onClick="searchHighPriority">High Priority</button></li>
							<li><button class="Text" data-onClick="searchMediumPriority">Medium Priority</button></li>
						</ul>
					</div>
				</div>
			</div>	
			<div id="SearchResults" class="Container Project">
				<header>
					<button class="Icon back" data-onClick="back"></button><div class="title"><input data-type="title" data-onClick="editTitle"/></div>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
					</ul>
				</header>
				<div class="TaskList">	
					<canvas id="tmpCanvas"></canvas>
					<ul></ul>
				</div>
				<footer>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
					</ul>
				</footer>
			</div>
			<div id="Project" class="Container Project">
				<header>
					<button class="Icon back" data-onClick="back"></button><div class="title"><input data-type="title" data-onClick="editTitle"/></div>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
						<li><button class="Icon incomplete current" data-onClick="filterAll"></button></li>
						<li><button class="Icon star" data-onClick="filterStarred"></button></li>
						<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
						<li><button class="Icon add" data-onClick="add"></button></li>
					</ul>
				</header>
				<div class="TaskList">	
					<canvas id="tmpCanvas"></canvas>
					<ul></ul>
				</div>
				<footer>
					<ul class="Toolbar">
						<li><button class="Icon top" data-onClick="scrollToTop"></button></li>
						<li><button class="Icon incomplete current" data-onClick="filterAll"><span data-onClick="filterAll"></span></button></li>
						<li><button class="Icon star" data-onClick="filterStarred"><span data-onClick="filterStarred"></span></button></li>
						<li><button class="Icon complete" data-onClick="filterComplete"></button></li>
					</ul>
				</footer>
			</div>
			<div id="AddTask" class="Modal">
				<div class="wrapper Popup">
					<div id="AddScribble"></div>
					<footer class="buttons">
						<ul class="Toolbar">
							<li><button class="Icon undo" data-onClick="undo"></button></li>
							<li><button class="Icon redo" data-onClick="redo"></button></li>
							<li><button class="Icon star off" data-onClick="star"></button></li>
							<li><button class="Icon priority" data-priority="0" data-onClick="priority"><span data-onClick="priority"></span></button>
								<section class="PriorityChooser Popup"></section>
							</li>
							<li><button class="Icon add" data-onClick="add">+</button></li>
							<li><button class="Icon addMulti" data-onClick="addAnother"></button></li>
							<li><button class="Icon clear" data-onClick="cancel"></button></li>
					</footer>
				</div>
			</div>
			<div id="DebugMenu" class="Modal">
				<div class="wrapper Popup">
					<ul class="Toolbar">
						<li><button class="Text" data-onClick="clear">Clear Images</button></li>
						<li><button class="Text" data-onClick="backup">Backup</button></li>
						<li><button class="Text" data-onClick="restore">Restore</button></li>
						<li><button class="Text" data-onClick="close">Close</button></li>
					</ul>
					<div class="backup">
						<textarea></textarea>
					</div>
					<div class="restore">
						<textarea></textarea>
						<button data-onClick="restoreNow">Restore</button>
					</div>
				</div>
			</div>
			<div id="TaskMenu"></div>
		</div></div>
		<script type="text/html" id="jstPriorityChooser">
			{! for (var pi = -1, c = 3; pi < c; pi++) { !}
				<button class="Icon priority" data-key="{!= key !}" data-priority="{!= pi !}" data-onClick="setPriority"><span data-onClick="setPriority"></span></button>
			{! } !}
		</script>
		<script type="text/html" id="jstProjectListView">
			{! for (var i = 0, c = projects.length; i < c; i++) { var project = projects[i]; !}
				<li>
					<div class="name" data-key="{!= project.key !}" data-index="{!= i !}" data-onClick="project">{!= project.name !}</div>
					<div class="count">{!= project.starCount !}</div>
					<div class="sep">/</div>
					<div class="count">{!= project.incompleteCount !}</div>
					<button data-index="{!= i !}" data-onClick="delete">X</button>
				</li>
			{! } !}
		</script>
		<script type="text/html" id="jstProjectView">
			{! for (var i = 0, c = tasks.length; i < c; i++) { var task = tasks[i]; !}
            <li class="taskItem" data-key="{!= task.key !}" data-index="{!= i !}">
				{!= template("jstTaskView", { index: i, task: task, useImage: useImage, canEditTask: canEditTask }) !}
			</li>
			{! } !}	
			{! if (hasMore) { !}
			<li class="viewMore"><button data-onClick="viewMore" class="Text">View More</button></li>
			{! } !}
		</script>
		<script type="text/html" id="jstTaskView">
			<div class="buttons">
				<input type="checkbox" data-onClick="complete" {!= (task.isComplete)?"checked":"" !}/>
				<button data-index="{!= index !}" class="Icon star {!= (!task.star)?"off":"" !}" data-onClick="star"></button>
				<button class="Icon priority" data-priority="{!= task.priority !}" data-onClick="priority"><span data-onClick="priority"></span></button>
				<section class="PriorityChooser Popup">
					{!= template("jstPriorityChooser", { key: index }) !}
				</section>
			</div>
			{! if (task.name) { !}
			<div class="task" data-onClick="task">
				{!= task.name !}
			</div>
			{! } else { !}
			<div id="Scribble_{!= index !}" class="task scribble">
				{! if (!useImage) { !}
					<canvas></canvas>
				{! } else if (task.imageData) { !}
					<img src="{!= task.imageData !}"/>
				{! } !}
			</div>
			{! } !}
			{! if (canEditTask) { !}
			<menu>
				<li><button class="Icon edit" data-onClick="task"></button></li>
				<li><button class="Icon menu" data-index="{!= index !}" data-onClick="menu"></button></li>
			</menu>
			{! } !}
			<div class="complete {!= (task.isComplete)?"c":"" !}"></div>
		</script>
		<script type="text/html" id="jstTaskMenu">
			<div class="Modal">
				<section class="wrapper Popup">
					<header>
						<div class="title">Task Menu:</div>
						<button class="Icon clear" data-onClick="close"></button>
					</header>
					<menu>
						<li>Project: 
							<select class="project">
								{! for (var i = 0, c = projects.length; i < c; i++) { var proj = projects[i]; !}
									<option value="{!= i !}" {!= (proj.key == project.key)?"selected":"" !}>{!= proj.name !}</option>
								{! } !}
							</select>
							</select>
						</li>
						<li><button data-onClick="delete">Delete Task</button></li>
					</menu>
				</section>
			</div>
		</script>
		<script src="phonegap.js"></script>
        <script src="ui/scripts/app.lawnchair.js"></script>
		<script src="ui/scripts/iscroll.js"></script>
		<script src="ui/scripts/Badge.js"></script>
		<script src="ui/scripts/SwipeController.js"></script>
		<script src="ui/scripts/ScribbleTasksApp.js"></script>
		<script src="dataproviders/projects.js"></script>
		<script src="dataproviders/tasks.js"></script>
		<script src="models/project.js"></script>
		<script src="models/task.js"></script>
		<script src="controllers/add_task.js"></script>
		<script src="controllers/project.js"></script>
		<script src="controllers/search.js"></script>
		<script src="controllers/project_list.js"></script>
		<script src="controllers/task_menu.js"></script>
		<script src="controllers/debug_controller.js"></script>
		<script src="views/scribble.js"></script>
		<!--
		<script src="ui/scripts/scribbletasks.min.js"></script>
		--!>
		<script>
            var app = new ScribbleTasksApp();
			var params = parseQueryString();

			if (params.mobile)
				app.browser.isMobile = true;
			if (!params.pg)
				app.browser.isPhoneGap = true;

			app.bind("resize", function(width, height) {
				if (this.browser.isPhoneGap)
					height -= 20;
				console.log(height);
				if (height < 500) {
					document.querySelector("#AddTask .wrapper").style.height = height+"px";
				}
				var wrapper = document.querySelector("#Wrapper");
				height -= (wrapper.offsetTop*2);	
				var containers = document.querySelectorAll(".Container");
				for (var i = 0, c = containers.length; i < c; i++) {
					containers[i].style.height = height+"px";
				}
				
			});
            app.bind("ready", function() {
				this.clearImageCache();
				if (this.browser.isMobile) {
					/*
					if (!this.browser.isPhoneGap) {
						setTimeout(function() { 
							window.scrollTo(0, 1);
						}, 100);
					}
					*/
					app.disableScrollingPermanently();
				}
				app.resize();
				var c = new ProjectListController("ProjectList");
				var params = parseQueryString();
				//* Tests
				if (params.test) {
					if (params.test == "1" || params.test == "2" || params.test == "4") {
						var f = false;
						c.bind("loaded", function() {
							if (f) return;
							var pc = this.showProject(this.projects[0]);
							if (params.test == "2")
								pc.showAddTask();
							if (params.test == "4")
								pc.onClick.menu();
							f = true;

						});
					} else if (params.test == "3") {
						c.onClick.debug();
					} else if (params.test == "search") {
						c.bind("loaded", function() {
							c.onClick.search.call(c);
							//c.showSearch("Starred Tasks", Task.filters.star);
						});
					}
				}
				//*/
				window.controller = c;
				return;
				APP.backup(function(data) { 
					var textarea = document.createElement("textarea");
					textarea.style.height = "400px";
					textarea.style.width = "100%";

					textarea.value = data;
					document.body.innerHTML = ""; 
					document.body.appendChild(textarea);
				});
			});
		</script>
	</body>
</html>
