var extendObj=function(target,obj1,obj2){for(var item in obj1){target[item]=obj1[item];}
return(obj2)?extendObj(target,obj2):target;}
var extendObjStrict=function(target,obj1,obj2){for(var item in obj1){if(target[item]!==undefined)
target[item]=obj1[item];}
return(obj2)?extendObj(target,obj2):target;}
Array.prototype.indexOf=function(v,b,s){for(var i=+b||0,l=this.length;i<l;i++){if(this[i]===v||s&&this[i]==v){return i;}}
return-1;};Array.prototype.insert=function(i,v){if(this.length==0)
return[v];if(i>=0){var a=this.slice(),b=a.splice(i);a[i]=v;return a.concat(b);}};Array.prototype.indexOf=function(obj){for(var i=0;i<this.length;i++){if(obj==this[i])
return i;}
return-1;};Array.prototype.each=function(f){for(var i=0;i<this.length;i++){f(this[i]);}};Array.prototype.find=function(f){for(var i=0;i<this.length;i++){if(f(this[i]))
return this[i];}};Array.prototype.filter=function(f){var filter=[];for(var i=0;i<this.length;i++){if(f(this[i]))
filter.push(this[i]);}
return filter;};Array.prototype.contains=function(obj){for(var i=0;i<this.length;i++){if(obj==this[i])
return true;}};Array.prototype.clone=function(){var clone=[];for(var i=0;i<this.length;i++){clone.push(this[i]);}
return clone;};Array.prototype.remove=function(from,to){this.splice(from,(to||from||1)+(from<0?this.length:0));return this.length;};Array.prototype.extend=function(array){for(var i=0;i<array.length;i++){this.push(array[i]);}}
if(typeof debug==="undefined"){window.debug=console;}
(function(){var undefined,xui,window=this,string=new String('string'),document=window.document,simpleExpr=/^#?([\w-]+)$/,idExpr=/^#/,tagExpr=/<([\w:]+)/,slice=function(e){return[].slice.call(e,0);};try{var a=slice(document.documentElement.childNodes)[0].nodeType;}
catch(e){slice=function(e){var ret=[];for(var i=0;e[i];i++)ret.push(e[i]);return ret;};}
window.x$=window.xui=xui=function(q,context){return new xui.fn.find(q,context);};if(![].forEach){Array.prototype.forEach=function(fn){var len=this.length||0,i=0;that=arguments[1];if(typeof fn=='function'){for(;i<len;i++){fn.call(that,this[i],i,this);}}};}
function removex(array,from,to){var rest=array.slice((to||from)+1||array.length);array.length=from<0?array.length+from:from;return array.push.apply(array,rest);}
xui.fn=xui.prototype={extend:function(o){for(var i in o){xui.fn[i]=o[i];}},find:function(q,context){var ele=[],tempNode;if(!q){return this;}else if(context==undefined&&this.length){ele=this.each(function(el){ele=ele.concat(slice(xui(q,el)));}).reduce(ele);}else{context=context||document;if(typeof q==string){if(simpleExpr.test(q)){ele=idExpr.test(q)?[context.getElementById(q.substr(1))]:context.getElementsByTagName(q);if(ele[0]==null){ele=[];}}else if(tagExpr.test(q)){tempNode=document.createElement('i');tempNode.innerHTML=q;slice(tempNode.childNodes).forEach(function(el){ele.push(el);});}else{if(window.Sizzle!==undefined){ele=Sizzle(q);}else{ele=context.querySelectorAll(q);}}
ele=slice(ele);}else if(q instanceof Array){ele=q;}else if(q.toString()=='[object NodeList]'){ele=slice(q);}else if(q.nodeName||q===window){ele=[q];}}
return this.set(ele);},set:function(elements){var ret=xui();ret.cache=slice(this.length?this:[]);ret.length=0;[].push.apply(ret,elements);return ret;},reduce:function(elements,b){var a=[],elements=elements||slice(this);elements.forEach(function(el){if(a.indexOf(el,0,b)<0)
a.push(el);});return a;},has:function(q){var list=xui(q);return this.filter(function(){var that=this;var found=null;list.each(function(el){found=(found||el==that);});return found;});},filter:function(fn){var elements=[];return this.each(function(el,i){if(fn.call(el,i))elements.push(el);}).set(elements);},not:function(q){var list=slice(this);return this.filter(function(i){var found;xui(q).each(function(el){return found=list[i]!=el;});return found;});},each:function(fn){for(var i=0,len=this.length;i<len;++i){if(fn.call(this[i],this[i],i,this)===false)
break;}
return this;}};xui.fn.find.prototype=xui.fn;xui.extend=xui.fn.extend;xui.extend({html:function(location,html){clean(this);if(arguments.length==0){return this[0].innerHTML;}
if(arguments.length==1&&arguments[0]!='remove'){html=location;location='inner';}
if(html.each!==undefined){var that=this;html.each(function(el){that.html(location,el);});return this;}
return this.each(function(el){var parent,list,len,i=0;if(location=="inner"){if(typeof html==string){el.innerHTML=html;list=el.getElementsByTagName('SCRIPT');len=list.length;for(;i<len;i++){eval(list[i].text);}}else{el.innerHTML='';el.appendChild(html);}}else if(location=="outer"){el.parentNode.replaceChild(wrapHelper(html,el),el);}else if(location=="top"){el.insertBefore(wrapHelper(html,el),el.firstChild);}else if(location=="bottom"){el.insertBefore(wrapHelper(html,el),null);}else if(location=="remove"){el.parentNode.removeChild(el);}else if(location=="before"){el.parentNode.insertBefore(wrapHelper(html,el.parentNode),el);}else if(location=="after"){el.parentNode.insertBefore(wrapHelper(html,el.parentNode),el.nextSibling);}});},append:function(html){return this.html(html,'bottom');},prepend:function(html){return this.html(html,'top');},attr:function(attribute,val){if(arguments.length==2){return this.each(function(el){el.setAttribute(attribute,val);});}else{var attrs=[];this.each(function(el){var val=el.getAttribute(attribute);if(val!=null)
attrs.push(val);});return attrs;}}});function getTag(el){return(el.firstChild===null)?{'UL':'LI','DL':'DT','TR':'TD'}[el.tagName]||el.tagName:el.firstChild.tagName;}
function wrapHelper(html,el){return(typeof html==string)?wrap(html,getTag(el)):html;}
function wrap(xhtml,tag){var attributes={},re=/^<([A-Z][A-Z0-9]*)([^>]*)>([\s\S]*)<\/\1>/i,element,x,a,i=0,attr,node,attrList;if(re.test(xhtml)){result=re.exec(xhtml);tag=result[1];if(result[2]!==""){attrList=result[2].split(/([A-Z]*\s*=\s*['|"][A-Z0-9:;#\s]*['|"])/i);for(;i<attrList.length;i++){attr=attrList[i].replace(/^\s*|\s*$/g,"");if(attr!==""&&attr!==" "){node=attr.split('=');attributes[node[0]]=node[1].replace(/(["']?)/g,'');}}}
xhtml=result[3];}
element=document.createElement(tag);for(x in attributes){a=document.createAttribute(x);a.nodeValue=attributes[x];element.setAttributeNode(a);}
element.innerHTML=xhtml;return element;}
function clean(collection){var ns=/\S/;collection.each(function(el){var d=el,n=d.firstChild,ni=-1,nx;while(n){nx=n.nextSibling;if(n.nodeType==3&&!ns.test(n.nodeValue)){d.removeChild(n);}else{n.nodeIndex=++ni;}
n=nx;}});}
xui.extend({on:function(type,fn,details){return this.each(function(el){if(xui.events[type]){var id=_getEventID(el),responders=_getRespondersForEvent(id,type);details=details||{};details.handler=function(event,data){xui.fn.fire.call(xui(this),type,data);};if(!responders.length){xui.events[type].call(el,details);}}
el.addEventListener(type,_createResponder(el,type,fn),false);});},un:function(type,fn){return this.each(function(el){var id=_getEventID(el),responders=_getRespondersForEvent(id,type),i=responders.length;while(i--){if(fn===undefined||fn.guid===responders[i].guid){el.removeEventListener(type,responders[i],false);removex(cache[id][type],i,1);}}
if(cache[id][type].length===0)delete cache[id][type];for(var t in cache[id]){return;}
delete cache[id];});},fire:function(type,data){return this.each(function(el){if(el==document&&!el.dispatchEvent)
el=document.documentElement;var event=document.createEvent('HTMLEvents');event.initEvent(type,true,true);event.data=data||{};event.eventName=type;el.dispatchEvent(event);});}});xui.events={};xui.touch=(function(){try{return!!(document.createEvent("TouchEvent").initTouchEvent)}catch(e){return false;};})();var cache={};function _getEventID(element){if(element._xuiEventID)return element._xuiEventID;return element._xuiEventID=++_getEventID.id;}
_getEventID.id=1;function _getRespondersForEvent(id,eventName){var c=cache[id]=cache[id]||{};return c[eventName]=c[eventName]||[];}
function _createResponder(element,eventName,handler){var id=_getEventID(element),r=_getRespondersForEvent(id,eventName);var responder=function(event){if(handler.call(element,event)===false){event.preventDefault();event.stopPropagation();}};responder.guid=handler.guid=handler.guid||++_getEventID.id;responder.handler=handler;r.push(responder);return responder;}
xui.extend({tween:function(props,callback){var emileOpts=function(o){var options={};"duration after easing".split(' ').forEach(function(p){if(props[p]){options[p]=props[p];delete props[p];}});return options;}
var serialize=function(props){var serialisedProps=[],key;if(typeof props!=string){for(key in props){serialisedProps.push(key+':'+props[key]);}
serialisedProps=serialisedProps.join(';');}else{serialisedProps=props;}
return serialisedProps;};if(props instanceof Array){props.forEach(function(a){});}
var opts=emileOpts(props);var prop=serialize(props);return this.each(function(e){emile(e,prop,opts,callback);});}});function hasClass(el,className){return getClassRegEx(className).test(el.className);}
var rtrim=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;function trim(text){return(text||"").replace(rtrim,"");}
xui.extend({setStyle:function(prop,val){return this.each(function(el){el.style[prop]=val;});},getStyle:function(prop,callback){return(callback===undefined)?getStyle(this[0],prop):this.each(function(el){callback(getStyle(el,prop));});},addClass:function(className){return this.each(function(el){if(hasClass(el,className)===false){el.className=trim(el.className+' '+className);}});},hasClass:function(className,callback){return(callback===undefined&&this.length==1)?hasClass(this[0],className):this.each(function(el){if(hasClass(el,className)){callback(el);}});},removeClass:function(className){if(className===undefined){this.each(function(el){el.className='';});}else{var re=getClassRegEx(className);this.each(function(el){el.className=el.className.replace(re,'$1');});}
return this;},css:function(o){for(var prop in o){this.setStyle(prop,o[prop]);}
return this;}});function getStyle(el,p){return document.defaultView.getComputedStyle(el,"").getPropertyValue(p.replace(/[A-Z]/g,function(m){return'-'+m.toLowerCase();}));}
var reClassNameCache={},getClassRegEx=function(className){var re=reClassNameCache[className];if(!re){re=new RegExp('(^|\\s+)'+className+'(?:\\s+|$)');reClassNameCache[className]=re;}
return re;};xui.extend({xhrjson:function(url,options){var that=this;var cb=typeof cb!='function'?function(x){return x}:options.callback;var callback=function(){var o=eval('('+this.responseText+')');for(var prop in o){xui(options.map[prop]).html(cb(o[prop]));}};options.callback=callback;this.xhr(url,options);return this;}});"inner outer top bottom remove before after".split(' ').forEach(function(method){xui.fn[method]=function(html){return this.html(method,html);};});var cache={};"click load submit touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend orientationchange".split(' ').forEach(function(event){xui.fn[event]=function(fn){return fn?this.on(event,fn):this.fire(event);};});xui.extend({nativeAnimate:function(options,callback){this.animationStack=[];if(options instanceof Array){for(var i=0;i<options.length;i++){this.animationStack.push(options[i]);}}else if(options instanceof Object){this.animationStack.push(options);}
this.start(callback);return this;},animationStack:[],start:function(callback){var t=0,len=this.animationStack.length,i,options,duration;for(i=0;i<this.animationStack.length;i++){options=this.animationStack[i];duration=options.duration===undefined?0.5:options.duration;window.setTimeout(function(s,o,i){s.animate(o);if((i===len-1)&&callback&&typeof(callback)==='function'){callback();}},t*1000*duration,this,options,i);t+=duration;}
return this;},animate:function(options){var that=this,opt_after=options.after,easing=(options.easing===undefined)?'ease-in':options.easing,before=(options.before===undefined)?function(){}:options.before,after=(opt_after===undefined)?function(){}:function(){opt_after.apply(that);},duration=(options.duration===undefined)?0.5:options.duration,translate=options.by,rotate=options.rotate;options.easing=options.rotate=options.by=options.before=options.after=options.duration=undefined;before.apply(before.arguments);this.setStyle('-webkit-transition','all '+duration+'s '+easing);this.each(function(el){for(var prop in options){that.setStyle(prop,options[prop]);}
if(translate){that.setStyle('-webkit-transform',that.translateOp(translate[0],translate[1]));}
if(rotate){that.setStyle('-webkit-transform',that.rotateOp(rotate[0],rotate[1]));}});window.setTimeout(function(){that.setStyle('-webkit-transition','none');},duration*1000);window.setTimeout(function(){that.setStyle('-webkit-transform','none');},duration*1000);window.setTimeout(after,duration*1000);return this||that;},translateOp:function(xPixels,yPixels){return'translate('+xPixels+'px, '+yPixels+'px)';},rotateOp:function(axis,degree){return'rotate'+axis.toUpperCase()+'('+degree+'deg)';}});xui.extend({_toQueryString:function(docForm){var submitString='',formElement='',lastElementName='',length=docForm.length,i;for(i=0;i<length;i++){formElement=docForm[i];switch(formElement.type){case'text':case'select-one':case'hidden':case'password':case'textarea':submitString+=formElement.name+'='+encodeURIComponent(formElement.value)+'&';break;case'radio':if(formElement.checked){submitString+=formElement.name+'='+encodeURIComponent(formElement.value)+'&';}
break;case'checkbox':if(formElement.checked){if(formElement.name==lastElementName){if(submitString.lastIndexOf('&')===submitString.length-1){submitString=submitString.substring(0,submitString.length-1);}
submitString+=','+encodeURIComponent(formElement.value);}else{submitString+=formElement.name+'='+encodeURIComponent(formElement.value);}
submitString+='&';lastElementName=formElement.name;}
break;}}
submitString=submitString.substring(0,submitString.length-1);return submitString;}});xui.extend({add:function(q){[].push.apply(this,slice(xui(q)));return this.set(this.reduce());},end:function(){return this.set(this.cache||[]);},first:function(){return this.get(0);},get:function(index){return this[index];},eq:function(idx1,idx2){idx2=idx2?idx2+1:idx1+1;return this.set([].slice.call(this,idx1,idx2));},size:function(){return this.length;}});xui.extend({xhrjson:function(url,options){var that=this;var cb=typeof cb!='function'?function(x){return x}:options.callback;var callback=function(){var o=eval('('+this.responseText+')');for(var prop in o){xui(options.map[prop]).html(cb(o[prop]));}};options.callback=callback;this.xhr(url,options);return this;}});})();(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}
function Class(){if(!initializing&&this.init)
this.init.apply(this,arguments);}
Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};})();var Browser=function(){this.isMobile=(navigator.userAgent.match(/iPad|iPhone/i)!=null);this.isPhoneGap=false;}
browser=new Browser();if(browser.isMobile){INPUT_EVENT="touchstart";INPUT_START_EVENT="touchstart";INPUT_MOVE_EVENT="touchmove";INPUT_END_EVENT="touchend";}else{INPUT_EVENT="click";INPUT_START_EVENT="mousedown";INPUT_MOVE_EVENT="mousemove";INPUT_END_EVENT="mouseup";}
var templateCache={};var template=function tmpl(template,data){var fn=!/\W/.test(template)?templateCache[template]=templateCache[template]||tmpl(document.getElementById(template).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
template.replace(/[\r\t\n]/g,"").split("{!").join("\t").replace(/((^|!})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!}/g,"',$1,'").split("\t").join("');").split("!}").join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;};var EventManager=Class.extend({init:function(){},bind:function(event,callback){if(typeof event==="object"){for(var key in event){this.bind(key,event[key]);}}else{this.callbacks=this.callbacks||{}
this.callbacks[event]=this.callbacks[event]||[];this.callbacks[event].push(callback);}
return this;},trigger:function(name,data){this.callbacks=this.callbacks||{}
var callbacks=this.callbacks[name];if(callbacks){for(var i=0;i<callbacks.length;i++){callbacks[i].apply(this,data||[]);}}
return this;},unbind:function(event,callback){this.callbacks=this.callbacks||{}
if(callback){var callbacks=this.callbacks[event]||[];for(var i=0;i<callbacks.length;i++){if(callbacks[i]===callback){this.callbacks[event].splice(i,1);}}}else{delete this.callbacks[event];}
return this;}});var Controller=Class.extend({init:function(element){this.element=element;},bindClickEvents:function(obj){var self=this;var $element=x$(this.element);for(var key in obj){x$(key).on(INPUT_EVENT,self._clickEvent(obj[key]));}},_clickEvent:function(f){var self=this;return function(){f.call(self);}},hide:function(){this.element.setStyle("display","none");},show:function(){this.element.setStyle("display","block");},animate:function(properties,cb){var self=this;var endAnimate=function(event){console.log("end animation");self.element[0].removeEventListener("webkitTransitionEnd",endAnimate,false);return;if(cb)
cb();}
for(prop in properties){this.element.setStyle(prop,properties[prop]);}
this.element[0].addEventListener("webkitTransitionEnd",endAnimate,false);},animateWithClass:function(className,properties,cb){this.animate(properties,cb);}});var DataProvider=Class.extend({init:function(key){},get:function(cb){},getById:function(id,cb){},save:function(obj,cb){if(cb)cb();},remove:function(obj,cb){},removeAll:function(){}});var View=EventManager.extend({init:function(elementId){this.element=document.getElementById(elementId);if(this.useLiveClickEvents){var self=this;this.element.addEventListener("click",function(e){if(self.onClick[e.target.getAttribute("data-click")]){self.onClick[e.target.getAttribute("data-click")].call(self,e);}});}},bindViewEvent:function(selector,eventName,f){this.bindElementEvent(this.element,selector,eventName,f);},bindElementEvent:function(element,selector,eventName,f){var elements=element.querySelectorAll(selector);for(var i=0;i<elements.length;i++){elements[i].addEventListener(eventName,f);}},find:function(selector){return this.element.querySelector(selector);},findAll:function(selector){return this.element.querySelectorAll(selector);},remove:function(){this.element.innerHTML="";},useLiveClickEvents:false});var TemplateView=View.extend({_render:function(templateId,data){var tmp=template(templateId,data);this.element.innerHTML=tmp;}});var Model=Class.extend({init:function(initial){if(!this._data)this._data={};if(initial){extendObjStrict(this._data,initial);}
this.id='';var self=this;for(var prop in this._data){var get=function(p){return function(){return self._getProperty(p);}}(prop);var set=function(p){return function(value){self._setProperty(p,value);}}(prop);this.__defineGetter__(prop,get);this.__defineSetter__(prop,set);}},_getProperty:function(prop){return this._data[prop];},_setProperty:function(prop,value){this._data[prop]=value;this._propertySet(prop,value);},_propertySet:function(prop,value){},__defineProperty__:function(key,getter,setter){this.__defineGetter__(key,getter);if(setter)this.__defineSetter__(key,setter);}});var Lawnchair=function(opts){this.init(opts);}
Lawnchair.prototype={init:function(opts){var adaptors={'webkit':window.WebkitSQLiteAdaptor,'gears':window.GearsSQLiteAdaptor,'dom':window.DOMStorageAdaptor,'cookie':window.CookieAdaptor,'air':window.AIRSQLiteAdaptor,'userdata':window.UserDataAdaptor,'air-async':window.AIRSQLiteAsyncAdaptor,'blackberry':window.BlackBerryPersistentStorageAdaptor};this.adaptor=opts.adaptor?new adaptors[opts.adaptor](opts):new WebkitSQLiteAdaptor(opts);if(!JSON||!JSON.stringify)throw"Native JSON functions unavailable - please include http://www.json.org/json2.js or run on a decent browser :P";},save:function(obj,callback){this.adaptor.save(obj,callback)},get:function(key,callback){this.adaptor.get(key,callback)},exists:function(callback){this.adaptor.exists(callback)},all:function(callback){this.adaptor.all(callback)},remove:function(keyOrObj,callback){this.adaptor.remove(keyOrObj,callback)},nuke:function(callback){this.adaptor.nuke(callback);return this},paged:function(page,callback){this.adaptor.paged(page,callback)},find:function(condition,callback){var is=(typeof condition=='string')?function(r){return eval(condition)}:condition;var cb=this.adaptor.terseToVerboseCallback(callback);this.each(function(record,index){if(is(record))cb(record,index);});},each:function(callback){var cb=this.adaptor.terseToVerboseCallback(callback);this.all(function(results){var l=results.length;for(var i=0;i<l;i++){cb(results[i],i);}});}};var LawnchairAdaptorHelpers={merge:function(defaultOption,userOption){return(userOption==undefined||userOption==null)?defaultOption:userOption;},terseToVerboseCallback:function(callback){return(typeof arguments[0]=='string')?function(r,i){eval(callback);}:callback;},now:function(){return new Date().getTime();},uuid:function(len,radix){var chars='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');var uuid=[];radix=radix||chars.length;if(len){for(var i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]='-';uuid[14]='4';for(var i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&0x3)|0x8:r];}}}
return uuid.join('');},serialize:function(obj){var r='';r=JSON.stringify(obj);return r;},deserialize:function(json){return eval('('+json+')');}};var WebkitSQLiteAdaptor=function(options){for(var i in LawnchairAdaptorHelpers){this[i]=LawnchairAdaptorHelpers[i];}
this.init(options);};WebkitSQLiteAdaptor.prototype={init:function(options){var that=this;var merge=that.merge;var opts=(typeof arguments[0]=='string')?{table:options}:options;this.name=merge('Lawnchair',opts.name);this.version=merge('1.0',opts.version);this.table=merge('field',opts.table);this.display=merge('shed',opts.display);this.max=merge(65536,opts.max);this.db=merge(null,opts.db);this.perPage=merge(10,opts.perPage);this.onError=function(){};this.onData=function(){};if("onError"in opts){this.onError=opts.onError;}
if(!window.openDatabase)
throw('Lawnchair, "This browser does not support sqlite storage."');this.db=openDatabase(this.name,this.version,this.display,this.max);this.db.transaction(function(tx){tx.executeSql("SELECT COUNT(*) FROM "+that.table,[],function(){},function(tx,error){that.db.transaction(function(tx){tx.executeSql("CREATE TABLE "+that.table+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",[],function(){},that.onError);});});});},save:function(obj,callback){var that=this;var update=function(id,obj,callback){that.db.transaction(function(t){t.executeSql("UPDATE "+that.table+" SET value=?, timestamp=? WHERE id=?",[that.serialize(obj),that.now(),id],function(){if(callback!=undefined){obj.key=id;that.terseToVerboseCallback(callback)(obj);}},that.onError);});};var insert=function(obj,callback){that.db.transaction(function(t){var id=(obj.key==undefined)?that.uuid():obj.key;delete(obj.key);t.executeSql("INSERT INTO "+that.table+" (id, value,timestamp) VALUES (?,?,?)",[id,that.serialize(obj),that.now()],function(){if(callback!=undefined){obj.key=id;that.terseToVerboseCallback(callback)(obj);}},that.onError);});};if(obj.key==undefined){insert(obj,callback);}else{this.get(obj.key,function(r){var isUpdate=(r!=null);if(isUpdate){var id=obj.key;delete(obj.key);update(id,obj,callback);}else{insert(obj,callback);}});}},get:function(key,callback){var that=this;this.db.transaction(function(t){t.executeSql("SELECT value FROM "+that.table+" WHERE id = ?",[key],function(tx,results){if(results.rows.length==0){that.terseToVerboseCallback(callback)(null);}else{var o=that.deserialize(results.rows.item(0).value);o.key=key;that.terseToVerboseCallback(callback)(o);}},this.onError);});},all:function(callback){var cb=this.terseToVerboseCallback(callback);var that=this;this.db.transaction(function(t){t.executeSql("SELECT * FROM "+that.table,[],function(tx,results){if(results.rows.length==0){cb([]);}else{var r=[];for(var i=0,l=results.rows.length;i<l;i++){var raw=results.rows.item(i).value;var obj=that.deserialize(raw);obj.key=results.rows.item(i).id;r.push(obj);}
cb(r);}},that.onError);});},paged:function(page,callback){var cb=this.terseToVerboseCallback(callback);var that=this;this.db.transaction(function(t){var offset=that.perPage*(page-1);var sql="SELECT * FROM "+that.table+" ORDER BY timestamp ASC LIMIT ? OFFSET ?";t.executeSql(sql,[that.perPage,offset],function(tx,results){if(results.rows.length==0){cb([]);}else{var r=[];for(var i=0,l=results.rows.length;i<l;i++){var raw=results.rows.item(i).value;var obj=that.deserialize(raw);obj.key=results.rows.item(i).id;r.push(obj);}
cb(r);}},that.onError);});},remove:function(keyOrObj,callback){var that=this;if(callback)
callback=that.terseToVerboseCallback(callback);this.db.transaction(function(t){t.executeSql("DELETE FROM "+that.table+" WHERE id = ?",[(typeof keyOrObj=='string')?keyOrObj:keyOrObj.key],callback||that.onData,that.onError);});},nuke:function(callback){var that=this;if(callback)
callback=that.terseToVerboseCallback(callback);this.db.transaction(function(tx){tx.executeSql("DELETE FROM "+that.table,[],callback||that.onData,that.onError);});}};var LawnchairData=DataProvider.extend({init:function(key){this.data=new Lawnchair(key);},find:function(cb){this.data.all(cb);},findById:function(id,cb){this.data.get(id,cb);},save:function(obj,cb){this.data.save(obj,cb)},remove:function(obj,cb){this.data.remove(obj.id,cb)},removeAll:function(){this.data.nuke();}});